# Redis Configuration for Auto Cache Purging
# This file demonstrates various Redis configurations for automatic cache management

# =============================================================================
# MEMORY MANAGEMENT
# =============================================================================

# Set maximum memory usage (uncomment and modify as needed)
# maxmemory 256mb
# maxmemory 1gb
# maxmemory 2gb

# Memory eviction policies when maxmemory is reached:
#
# noeviction - Don't evict anything, just return errors on write operations (default)
# allkeys-lru - Evict any key according to the LRU algorithm
# allkeys-lfu - Evict any key according to the LFU algorithm
# allkeys-random - Evict a random key
# volatile-lru - Evict a key among the ones with expiration set, LRU algorithm
# volatile-lfu - Evict a key among the ones with expiration set, LFU algorithm
# volatile-random - Evict a random key among the ones with expiration set
# volatile-ttl - Evict a key among the ones with expiration set, shorter TTL first

# Recommended for cache scenarios:
maxmemory-policy allkeys-lru

# =============================================================================
# LAZY EXPIRATION SETTINGS
# =============================================================================

# How many keys to check for expiration at each cycle (default: 20)
# Higher values = more CPU usage but faster expiration
# Lower values = less CPU usage but slower expiration
# active-expire-effort 1

# =============================================================================
# KEY EXPIRATION FREQUENCY
# =============================================================================

# Redis background task frequency (default: 10)
# This affects how often Redis checks for expired keys
# Range: 1-500, higher = more frequent checks
hz 100

# =============================================================================
# PERSISTENCE SETTINGS (affects cache behavior)
# =============================================================================

# Disable persistence for pure cache usage (optional)
# save ""
# appendonly no

# Or configure lightweight persistence
save 900 1      # Save if at least 1 key changed in 900 seconds
save 300 10     # Save if at least 10 keys changed in 300 seconds
save 60 10000   # Save if at least 10000 keys changed in 60 seconds

# =============================================================================
# REDIS MODULES (for RedisBloom cache management)
# =============================================================================

# Load RedisBloom module for probabilistic data structures
# loadmodule /usr/lib/redis/modules/redisbloom.so

# =============================================================================
# LOGGING (for monitoring cache operations)
# =============================================================================

# Log level: debug, verbose, notice, warning
loglevel notice

# Log expired keys operations (for debugging)
# syslog-enabled yes
# syslog-ident redis

# =============================================================================
# CLIENT CONFIGURATION
# =============================================================================

# Maximum number of connected clients
maxclients 10000

# Client idle timeout (automatically disconnect idle clients)
timeout 300

# =============================================================================
# NETWORK CONFIGURATION
# =============================================================================

# Bind to specific interface (0.0.0.0 for all interfaces)
bind 127.0.0.1

# Default port
port 6379

# TCP listen() backlog
tcp-backlog 511

# =============================================================================
# ADVANCED CACHE SETTINGS
# =============================================================================

# Close connection after client is idle for N seconds (0 to disable)
tcp-keepalive 300

# Enable/disable automatic memory defragmentation
# activedefrag yes

# Minimum percentage of fragmentation to start active defrag
# active-defrag-ignore-bytes 100mb
# active-defrag-threshold-lower 10

# Maximum percentage of fragmentation at which we use maximum effort
# active-defrag-threshold-upper 100

# =============================================================================
# EXAMPLE CONFIGURATIONS FOR DIFFERENT CACHE SCENARIOS
# =============================================================================

# Configuration for high-traffic web cache:
# maxmemory 2gb
# maxmemory-policy allkeys-lru
# hz 100
# save ""
# appendonly no

# Configuration for session store:
# maxmemory 512mb
# maxmemory-policy volatile-ttl
# hz 50
# timeout 0

# Configuration for distributed cache:
# maxmemory 4gb
# maxmemory-policy allkeys-lfu
# hz 100
# tcp-keepalive 60

# =============================================================================
# SECURITY (for production cache deployments)
# =============================================================================

# Require authentication (recommended for production)
# requirepass your-strong-password-here

# Rename dangerous commands (optional)
# rename-command FLUSHDB ""
# rename-command FLUSHALL ""
# rename-command CONFIG "CONFIG_b835b56c8a9a5b5b"
